<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multi-Channel Chat Moderation</title>
    <link rel="stylesheet" href="src/css/styles.css?v=2.1" />
  </head>
  <body>
    <!-- Navigation Bar -->
    <nav class="navbar">
      <ul class="navbar-menu">
        <li class="nav-item">
          <a href="viewer.html" class="nav-link">Viewer</a>
        </li>
        <li class="nav-item">
          <a href="index.html" class="nav-link active">Moderation</a>
        </li>
      </ul>
      <div class="navbar-user">
        <!-- User info will be injected here by JavaScript -->
      </div>
    </nav>
    
    <!-- Analytics Dashboard -->
    <div class="charts-container">
      <div class="chart-row">
        <div class="chart-container">
          <h3>Sentiment Distribution</h3>
          <canvas id="sentimentChart"></canvas>
        </div>
        <div class="chart-container">
          <h3>Channel Activity Over Time</h3>
          <canvas id="channelActivityChart"></canvas>
        </div>
      </div>
      <div class="chart-row">
        <div class="chart-container users-score-full-width">
          <h3>Users Tracked vs Average Score</h3>
          <canvas id="usersScoreChart"></canvas>
        </div>
      </div>
    </div>
    
    <div class="header">
      <div class="channel-info">
        <!-- Add Channel Form -->
        <div class="add-channel-form">
          <h3>Add a new channel to track</h3>
          <div class="form-row">
            <input
              type="text"
              id="channel-input"
              placeholder="Enter channel name"
              maxlength="50"
            />
            <button onclick="addChannel()" id="add-button">Add Channel</button>
          </div>
          <div id="add-channel-feedback"></div>
        </div>

        <!-- Channels List -->
        <div class="channels-container">
          <div id="channels-list">Loading channels...</div>
        </div>
      </div>
      <!-- Suspicious Users Section -->
      <div id="suspicious-users" class="suspicious-users">
        <h3>Suspicious Users</h3>
      </div>
    </div>
    
    <!-- Moderator Info - Removed, now in navbar -->
    </div>

    <h3 id="messages-title" class="messages-title">Logs from all channels</h3>
    <div id="messages-container" class="messages-container">
      <div class="loading">Loading messages...</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="src/js/auth.js?v=2.2"></script>
    <script src="src/js/app.js?v=2.2"></script>
    <script>
      // Initialize charts only if user is authenticated
      document.addEventListener('DOMContentLoaded', function() {
        const userData = localStorage.getItem('userData');
        const authToken = localStorage.getItem('authToken');
        
        if (userData && authToken) {
          // User is authenticated, load charts
          const script = document.createElement('script');
          script.src = 'src/js/charts.js?v=1.0';
          document.head.appendChild(script);
        }
      });
    </script>
  </body>
</html>
